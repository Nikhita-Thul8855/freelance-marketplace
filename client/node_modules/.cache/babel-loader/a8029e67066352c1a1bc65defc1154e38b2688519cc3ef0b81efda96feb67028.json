{"ast":null,"code":"import _objectSpread from\"C:/Users/PC/freelance-marketplace/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useCallback}from'react';import{useForm,Controller}from'react-hook-form';import{zodResolver}from'@hookform/resolvers/zod';import{useDropzone}from'react-dropzone';import{useNavigate}from'react-router-dom';import{useAuth}from'../context/AuthContext';import{useGigs}from'../context/GigContext';import{gigSchema}from'../utils/validationSchemas';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreateGig=()=>{var _errors$root;const[isLoading,setIsLoading]=useState(false);const[imageFiles,setImageFiles]=useState([]);const[imagePreviews,setImagePreviews]=useState([]);const[tags,setTags]=useState([]);const[tagInput,setTagInput]=useState('');const{user}=useAuth();const{createGig,error}=useGigs();const navigate=useNavigate();const{register,handleSubmit,control,formState:{errors},setError,setValue}=useForm({resolver:zodResolver(gigSchema),defaultValues:{tags:[],images:[]}});// Categories\nconst categories=['Web Development','Mobile Development','Design & Creative','Writing & Translation','Digital Marketing','Video & Animation','Music & Audio','Programming & Tech','Business','Lifestyle','Other'];// Image dropzone\nconst onDrop=useCallback(acceptedFiles=>{const newFiles=acceptedFiles.slice(0,5-imageFiles.length);const newPreviews=newFiles.map(file=>({file,preview:URL.createObjectURL(file)}));setImageFiles(prev=>[...prev,...newFiles]);setImagePreviews(prev=>[...prev,...newPreviews]);setValue('images',[...imageFiles,...newFiles]);},[imageFiles,setValue]);const{getRootProps,getInputProps,isDragActive}=useDropzone({onDrop,accept:{'image/*':['.jpeg','.jpg','.png','.gif']},maxFiles:5,disabled:imageFiles.length>=5});// Remove image\nconst removeImage=index=>{const newFiles=imageFiles.filter((_,i)=>i!==index);const newPreviews=imagePreviews.filter((_,i)=>i!==index);setImageFiles(newFiles);setImagePreviews(newPreviews);setValue('images',newFiles);};// Add tag\nconst addTag=()=>{if(tagInput.trim()&&tags.length<5&&!tags.includes(tagInput.trim())){const newTags=[...tags,tagInput.trim()];setTags(newTags);setValue('tags',newTags);setTagInput('');}};// Remove tag\nconst removeTag=tagToRemove=>{const newTags=tags.filter(tag=>tag!==tagToRemove);setTags(newTags);setValue('tags',newTags);};// Handle tag input\nconst handleTagKeyPress=e=>{if(e.key==='Enter'){e.preventDefault();addTag();}};const onSubmit=async data=>{// Check if user is freelancer\nif((user===null||user===void 0?void 0:user.role)!=='freelancer'){setError('root',{message:'Only freelancers can create gigs'});return;}setIsLoading(true);try{// Create FormData for file upload\nconst formData=new FormData();formData.append('title',data.title);formData.append('description',data.description);formData.append('price',data.price);formData.append('category',data.category);formData.append('deliveryTime',data.deliveryTime);// Add tags\ndata.tags.forEach(tag=>{formData.append('tags',tag);});// Add images\nimageFiles.forEach(file=>{formData.append('images',file);});const result=await createGig(formData);if(result.success){navigate('/my-gigs');}else{setError('root',{message:result.error});}}catch(error){setError('root',{message:'Failed to create gig'});}setIsLoading(false);};// Redirect if not freelancer\nif((user===null||user===void 0?void 0:user.role)!=='freelancer'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"Only freelancers can create gigs.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/dashboard'),className:\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\",children:\"Go to Dashboard\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-3xl mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-sm rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"Create New Gig\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Fill in the details to create your gig\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),className:\"p-6 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Gig Title *\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('title')),{},{type:\"text\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"I will do something amazing for you\"})),errors.title&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.title.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Category *\"}),/*#__PURE__*/_jsxs(\"select\",_objectSpread(_objectSpread({},register('category')),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a category\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category,children:category},category))]})),errors.category&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.category.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Description *\"}),/*#__PURE__*/_jsx(\"textarea\",_objectSpread(_objectSpread({},register('description')),{},{rows:6,className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Describe your gig in detail...\"})),errors.description&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.description.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Price (USD) *\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('price',{valueAsNumber:true})),{},{type:\"number\",min:\"5\",max:\"10000\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"50\"})),errors.price&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.price.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Delivery Time (Days) *\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},register('deliveryTime',{valueAsNumber:true})),{},{type:\"number\",min:\"1\",max:\"30\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"7\"})),errors.deliveryTime&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.deliveryTime.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Tags * (Max 5)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 mb-2\",children:tags.map((tag,index)=>/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800\",children:[tag,/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeTag(tag),className:\"ml-2 text-blue-600 hover:text-blue-800\",children:\"\\xD7\"})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:tagInput,onChange:e=>setTagInput(e.target.value),onKeyPress:handleTagKeyPress,disabled:tags.length>=5,className:\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100\",placeholder:\"Add a tag and press Enter\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:addTag,disabled:tags.length>=5||!tagInput.trim(),className:\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\",children:\"Add\"})]}),errors.tags&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.tags.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Images (Max 5)\"}),/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},getRootProps()),{},{className:\"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors \".concat(isDragActive?'border-blue-400 bg-blue-50':'border-gray-300 hover:border-gray-400',\" \").concat(imageFiles.length>=5?'opacity-50 cursor-not-allowed':''),children:[/*#__PURE__*/_jsx(\"input\",_objectSpread({},getInputProps())),/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600\",children:isDragActive?/*#__PURE__*/_jsx(\"p\",{children:\"Drop the images here...\"}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Drag & drop images here, or click to select files\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mt-1\",children:[imageFiles.length,\"/5 images uploaded\"]})]})})]})),imagePreviews.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4\",children:imagePreviews.map((preview,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:preview.preview,alt:\"Preview \".concat(index),className:\"w-full h-24 object-cover rounded-md\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeImage(index),className:\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600\",children:\"\\xD7\"})]},index))})]}),(error||errors.root)&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-md p-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error||((_errors$root=errors.root)===null||_errors$root===void 0?void 0:_errors$root.message)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/dashboard'),className:\"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading,className:\"flex-1 py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\",children:isLoading?'Creating Gig...':'Create Gig'})]})]})]})})});};export default CreateGig;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}